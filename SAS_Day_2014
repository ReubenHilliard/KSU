KSU SAS Day 2014
===
*RUN ALL FORMATS;
proc format;
VALUE URLformat 1= "ROBUST"
2 = "FUNCTIONAL"
3 = "INADEQUATE";run; quit;
proc format;
VALUE PopSLformat 1= "SPARSE"
2 = "MEDIUM"
3 = "DENSE";run; quit;
proc format;
VALUE VRLformat 1= "LO RISK"
2 = "HI RISK";run; quit;
proc format;
VALUE PRLformat 1= "LO RISK"
2 = "HI RISK";run; quit;
*Creating Labels;
data pop1.project5;
set pop1.project5;
label TPop = "Total State Population";
label PopSL = "Population Size Level";
label VCRate = "Violent Crime Rate";
label PCRate = "Property Crime Rate";
label VRL = "Violent Risk Level";
label PRL = "Property Risk Level";
label CCRate = "Combined Crime Rate";
label VC = "Violent Crime Total";
label PC = "Property Crime Total";
label URate = "Unemployment Rate (%)";
label Inc = "Median Household Income ($)";
label HS = "High School Education (%)";
label Edu = "Spending on Education per capita ($)";
label URL = "Unemployment Rate Level";run;
*saving to permanent library;
data pop1.project;set work.project;run;
*copy data to a second dataset;
data pop1.project1;set pop1.project;run;
*see the output tables;
proc print data=pop1.project;run;
*see the contents and variables for the dataset;
proc contents data=pop1.project1;run;
*Creating new variable, Unemployment Rate Level (URL);
data pop1.project2;
set pop1.project1;
if urate<0.050 then URL=1;
else if urate >=0.050 & urate <0.060 then URL=2;
else if urate >= 0.060 then URL=3;run;
*see table with new variable;
proc print data=pop1.project2 (obs=5);run;
*override existing librabry with new variable;
data pop1.project2;set pop1.project2;format URL URLformat.;run;
*see the frequency table;
proc freq data=pop1.project2;table URL;run;
*see the new variable added to the list;
proc contents data=pop1.project2;run;
* Creating a new variable, Population Size Level;
data pop1.project3;
set pop1.project2;
if TPop<2000000 then PopSL=1;
else if TPop >=2000000 & TPop <10000000 then PopSL=2;
else if TPop >= 0.060 then PopSL=3;run;
*override existing librabry with new variable;
data pop1.project3;set pop1.project3;format PopSL PopSLformat.;run;
*see table with new variable;
proc print data=pop1.project3 (obs=5);run;
* Creating a new variable, Violent Rate Level;
data pop1.project4;set pop1.project3;
if VCRate <400 then VRL=1;
else if VCRate >= 400 then VRL=2;run;
*override existing librabry with new variable;
data pop1.project4;set pop1.project4;format VRL VRLformat.;run;
*see table with new variable;
proc print data=pop1.project4 (obs=5);run; 
* Creating a new variable, Property Rate Level;
data pop1.project5;set pop1.project4;
if PCRate <2500 then PRL=1;
else if PCRate >=2500 then PRL=2;run;
*override existing librabry with new variable;
data pop1.project5;set pop1.project5;format PRL PRLformat.;run;
*see table with new variable;
ods rtf;title "Abbreviated Dataset";
proc print data=pop1.project5 (obs=5);run;ods rtf close;
*analysis1: descriptive statistics for education spending;
ods rtf;title "Table 1: Descriptive Statistics for Amount Spent on Education per capita by State & Local Govt.";
proc means data=pop1.project5 mean median stddev qrange min max maxdec=2;var edu;run;
*histogram for education spending; 
title "Figure 1: Histogram for Amount Spent on Education per capita by State & Local Govt.";
proc sgplot data=pop1.project5;
histogram edu/ fillattrs=(color=gold) transparency=0.5;
xaxis label = "Education Spending in Dollars ($)"; run;
*boxplot for education spending;
title "Figure 2: Boxplot for Amount Spent on Education per capita by State & Local Govt.";
proc sgplot data=pop1.project5;
vbox edu;
yaxis label = "Education Spending in Dollars ($)" valueshint min=1500 max=4500;run;
*analysis2: descriptive statistics for violent crime rate;
title "Table 2: Descriptive Statistics for Violent Crime Rate";
proc means data=pop1.project5 mean median stddev qrange min max maxdec=2;
var vcrate;run;
*histogram for violent crime rate; 
title "Figure 3: Histogram for Violent Crime Rate";
proc sgplot data=pop1.project5;
histogram vcrate/ fillattrs=(color=gold) transparency=0.5;
xaxis label = "Violent Crime Rate"; run;
*boxplot for education spending;
title "Figure 4: Boxplot for Violent Crime Rate";
proc sgplot data=pop1.project5;
vbox vcrate;
yaxis label = "Violent Crime Rate" valueshint min=-2 max=1500;run;
*analysis3: freq table for population size level;
title "Table 3: Frequency Table of Population Size Level";
proc freq data=pop1.project5;
tables popsl;run;
*analysis4: freq table for property risk level;
title "Table 4: Frequency Table of Property Risk Level";
proc freq data=pop1.project5;
tables prl;run; 
*analysis5: Descriptive Statistics for Median Household Income; 
title "Table 5: Descriptive Statistics for Median Household Income";
proc means data=pop1.project5 mean median stddev qrange min max maxdec=2;
var inc;run;
*histogram for Median Household Income; 
title "Figure 5: Histogram of Median Household Income";
proc sgplot data=pop1.project5;
histogram inc/ fillattrs=(color=gold) transparency=0.5;
xaxis label = "Median Household Income in Dollars($)"; run;
*boxplot for Median Household Income;
title "Figure 6: Boxplot of Median Household Income";
proc sgplot data=pop1.project5;
vbox inc;
yaxis label = "Median Household Income in Dollars($)" valueshint min=30000 max=70000;run;
*analysis6: create a frequency table for URL;
proc freq data=pop1.project5;
TITLE 'Table 6: Frequency Table of Unemployment Rate Level for The 50 States & DC';
tables URL;run;
*create and see the ordered bar chart;
PROC SGPLOT DATA = pop1.project5;
TITLE 'Figure 7: Bar Chart of Unemployment Rate Level for The 50 States & DC';
VBAR URL/ fillattrs=(color=green)  transparency=0.5;
XAXIS LABEL = 'Unemployment Rate';run;
*analysis7: unemployment rate level and violent risk level;
*contingency table for unemployment rate level by violent risk level;
title "Table 7: Contingency Table for Unemployment Rate Level (URL) by Violent Risk Level (VRL)";
proc sort data=pop1.project5;
by vrl;run;
proc freq data=pop1.project5;
tables url*vrl;run;
*100% Stacked Bar Chart for Unemployment Rate Level by Violent Risk Level with calculated freqs";
proc freq data=pop1.project5;
tables url*vrl;
ods output crosstabfreqs=ct;title;
data ct2;
set ct(drop = _type_ _table_ missing ColPercent Percent Frequency);
if not missing (rowpercent);run;title;
proc print data=ct2;run;
proc sgplot data = ct2;
title1 "Figure 8: 100% Stacked Bar Chart for Unemployment Rate Level by Violent Risk Level";
vbar url/ group = vrl response=rowpercent;
yaxis label= "Percent within Violent Risk Level";run;
*analysis8:  Property Crime Rate and Population Size Level;
*Sort by the variable Population Size Level;
proc sort data=pop1.project5;by popsl;run;
*Stratified Descriptive Statistics for pcrate by popsl;
title "Table 8: Stratified Descriptive Statistics for Property Crime Rate (PCRate) by Population Size Level (PopSL)";
proc means data=pop1.project5 mean median stddev qrange min max maxdec=2;var pcrate; by popsl;run;
*Side by Side Boxplots of Property Crime Rate by Population Size Level;
proc sgplot data=pop1.project5;
Title1 "Figure 9: Side By Side Boxplots for Property Crime Rate by Population Size Level";
vbox pcrate/ category=popsl;
yaxis label= "Property Crime Rate" valueshint min=1500 max=4500;
xaxis label = "Population Size Level";run;
*Stratified CI; *Creating a random sample of n=25;
title "SRS of N=25";
Proc surveyselect data=pop1.project5 
out=pop1.sample Method=SRS Sampsize=25 Seed=777;Run;
*checking to see random sample of 25;
title "Output for Random Sample of N=25";
Proc Print data=pop1.sample;Run;
*descriptive statistics for violent crime rate from the sample;
title "Table 9: Descriptive Statistics for Property Crime Rate";
proc means data=pop1.sample mean median stddev qrange min max maxdec=2;
var pcrate;run;
*creating a Confidence Interval for Property Crime Rate;
title "Table 10: Confidence Interval for Property Crime Rate";
proc means data=pop1.sample clm alpha=0.05;
var pcrate;run;
*analysis9: Calculate the Pearson Correlation Coefficients for HS vs. CCRate; 
ods graphics on;
title "Table 11 & 12: Descriptive Statistics and Pearson's Correlation Coefficient for High School Education and Combined Crime Rate"; 
proc corr data=pop1.project5;
 var ccrate hs;run;
ods graphics off;
*Scatterplot for Percent of Population over 25 with High School Education vs. Combined Crime Rate;
proc sgplot data=pop1.project5;
title "Figure 10: Scatterplot for Combined Crime Rate vs. Percent of Population over 25 with High School Education";
scatter x=hs y=ccrate;
xaxis label = "High School Education (%)";
yaxis label = "Combined Crime Rate";run;
*Regression Model for Combined Crime Rate vs. High School Education (%);
ods graphics on;
proc reg data=pop1.project5 plots =(CooksD); 
model ccrate=hs/r;run;
*Regression Model for Combined Crime Rate vs. Unemployment Rate;
ods graphics on;
proc reg data=pop1.project5 plots =(CooksD); 
model ccrate=urate/r;run;
*Sorting performance of bottom 10% of States;
proc sort data=pop1.project5 out=sorted; 
by descending urate descending hs;run;
proc print data=sorted (obs=5);
title "Table 13: Performance of Bottom 10% of States by metrics: Unemployment Rate and Percent High School Education";
var urate hs state ccrate;
ods rtf close;
*Saving sample data to a permanent dataset;
proc export data=pop1.sample
outfile = "\\client\H$\Spring 2014\Stat3010\HW3\sample.csv"
dbms=csv replace;run;

